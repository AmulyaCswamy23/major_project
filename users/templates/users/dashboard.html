{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Dashboard — EduWeb</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:Poppins,system-ui,Arial; background:#f4f7fa; color:#111; margin:0}
    .nav{background:#5b4dd6;color:#fff;padding:14px 28px;display:flex;justify-content:space-between;align-items:center}
    .nav a{color:#fff;text-decoration:none;margin-left:18px;font-weight:600}
    .container{max-width:1050px;margin:26px auto;padding:20px}
    .card{background:#fff;border-radius:12px;padding:22px;box-shadow:0 6px 18px rgba(0,0,0,0.06);margin-bottom:18px}
    .grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:18px}
    .small{background:#eef3ff;padding:18px;border-radius:10px}
    h1{margin:0 0 18px 0;font-size:28px}
    .recent {margin-top:14px}
    .item{display:flex;justify-content:space-between;align-items:center;padding:14px;border-radius:8px;border:1px solid #eee;margin-bottom:10px;background:#fff}
    .tag{display:inline-block;background:#eef2ff;padding:6px 10px;border-radius:8px;color:#1f2d78;margin-right:8px}
  </style>
</head>
<body>
  <header class="nav">
    <div style="font-weight:700;font-size:18px">
      <a href="{% url 'home' %}" style="color:#fff; text-decoration:none;">
      EduWeb
    </a>
    </div>
    <div>
      <a href="{% url 'dashboard' %}">Dashboard</a>
      <a href="{% url 'take_test' %}">Take Test</a>
      <a href="{% url 'roadmap_form' %}">Roadmap</a>
      <a href="{% url 'logout' %}">Logout</a>
    </div>
  </header>

  <main class="container">
    <div class="card">
      <h1>Welcome, {{ request.user.username|default:"Learner" }}</h1>

      <div class="grid">
        <div class="small">
          <strong>Current</strong>
          <p style="margin-top:8px">Language: <b>{{ current_language }}</b></p>
          <p>Level: <b>{{ current_level }}</b></p>

          {% if has_legend_for_current %}
            <p style="margin-top:8px"><span class="tag">Beginner</span><span class="tag">Intermediate</span><span class="tag">Legend</span></p>
          {% else %}
            <p style="margin-top:8px"><span class="tag">{{ current_level }}</span></p>
          {% endif %}
        </div>

        <div class="small">
          <strong>Tests</strong>
          <p style="margin-top:8px">Total: <b>{{ tests_total }}</b></p>
          <p>Today: <b>{{ tests_today }}</b></p>
          <p>Avg Score: <b>{{ avg_score }}%</b></p>
        </div>

        <div class="small">
          <strong>Badges & Languages</strong>
          <p style="margin-top:8px">Legend badges: <b>{{ legend_badges }}</b></p>
          <p style="margin-top:6px">Languages learned:
            {% if learned_languages %}
              {% for item in learned_languages %}
                 <span class="tag">{{ item.language }} — {{ item.level }}</span>
              {% endfor %}
    
            {% else %}
              <span style="color:#666">— none yet</span>
            {% endif %}
          </p>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 style="margin-bottom:12px">Recent Results</h2>

      <div class="recent">
        {% if recent_results %}
          {% for r in recent_results %}
            <div class="item">
              <div>
                <div style="font-weight:700">{{ r.language|capfirst }} — {{ r.difficulty }}</div>
                <div style="color:#666;font-size:13px;margin-top:6px">Score: {{ r.score }}% · Hints: {{ r.hints_used }} · {{ r.created_at|date:"d M Y H:i" }}</div>
              </div>
              <div style="font-weight:700">{{ r.score }}%</div>
            </div>
          {% endfor %}
        {% else %}
          <p>No recent results yet.</p>
        {% endif %}
      </div>
    </div>
  </main>
</body>
</html>